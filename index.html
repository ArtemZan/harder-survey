<!DOCTYPE html>
<!-- Modified version to capture form submissions and send to Google Sheets -->
<html lang="en" dir="ltr" translate="no">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Harder - AI Coach Questionnaire</title>
    <meta name="description" content="Help us build the perfect AI coach! Answer 4 quick questions about your goals and get early access to an AI that adapts to your energy and schedule.">
    <meta content="#1e1e45" name="theme-color">
    <meta content="width=device-width, initial-scale=1.0, viewport-fit=cover" name="viewport">
    
    <!-- Open Graph Meta Tags (Facebook, WhatsApp, LinkedIn, etc.) -->
    <meta property="og:title" content="Harder - AI Coach Questionnaire">
    <meta property="og:description" content="Help us build the perfect AI coach! Answer 4 quick questions about your goals and get early access to an AI that adapts to your energy and schedule.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://harder-survey.netlify.app/">
    <meta property="og:image" content="https://harder-survey.netlify.app/peak1.jpeg">
    <meta property="og:image:type" content="image/jpeg">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:image:alt" content="Mountain peak representing achieving goals with AI coaching">
    <meta property="og:image:secure_url" content="https://harder-survey.netlify.app/peak1.jpeg">
    <meta property="og:site_name" content="Harder AI Coach">
    <meta property="og:locale" content="en_US">
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Harder - AI Coach Questionnaire">
    <meta name="twitter:description" content="Help us build the perfect AI coach! Answer 4 quick questions about your goals and get early access to an AI that adapts to your energy and schedule.">
    <meta name="twitter:image" content="https://harder-survey.netlify.app/peak1.jpeg">
    
    <!-- Additional Meta Tags -->
    <meta name="author" content="Harder AI Coach">
    <meta name="robots" content="index, follow">
    
    <link href="https://fonts.googleapis.com/css2?family=Arvo:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="index.css">
</head>

<body>
    <div class="container">
        <!-- Progress Indicator -->
        <div class="progress-container">
            <div class="progress-dot active" data-step="1">1</div>
            <div class="progress-line"></div>
            <div class="progress-dot" data-step="2">2</div>
            <div class="progress-line"></div>
            <div class="progress-dot" data-step="3">3</div>
            <div class="progress-line"></div>
            <div class="progress-dot" data-step="4">4</div>
        </div>
        
        <form id="aiCoachForm" class="questions-container">
            <!-- Question 1: Struggle with Goals -->
            <div class="question">
                <h2>Do you sometimes struggle with achieving your goals? <span class="required">*</span></h2>
                <div class="choices">
                    <div class="choice" onclick="selectChoice('struggle_goals', 'yes_all_time', this)">
                        <input type="radio" name="struggle_goals" value="often" id="struggle_yes_all">
                        <label for="struggle_yes_all">Yes, often</label>
                    </div>
                    <div class="choice" onclick="selectChoice('struggle_goals', 'sometimes', this)">
                        <input type="radio" name="struggle_goals" value="Sometimes" id="struggle_sometimes">
                        <label for="struggle_sometimes">Sometimes</label>
                    </div>
                    <div class="choice" onclick="selectChoice('struggle_goals', 'crushing_it', this)">
                        <input type="radio" name="struggle_goals" value="rarely" id="struggle_no">
                        <label for="struggle_no">Rarely</label>
                    </div>
                </div>
            </div>

            <!-- Question 2: Life Change Scale -->
            <div class="question">
                <h2>We're going to give you a hand!</h2>
                <button class="submit-btn" type="button" onclick="nextQuestion()">How?</button>
            </div>

            <!-- Question 3: Life Change Scale -->
            <div class="question">
                <h2>Let's help you achieve your goals faster and more efficiently.</h2>
                <button class="submit-btn" type="button" onclick="nextQuestion()">How?</button>
            </div>

            <!-- Question 4: Life Change Scale -->
            <div class="question">
                <h2>We will generate steps to help you achieve your goals by adapting to your habits, behavior and feedback. How cool is
                    that? <span class="required">*</span></h2>
                <p>i.e. Adjust your workout, based on your results, struggles or preferences.
                    <p>
                <div class="scale-container">
                    <div class="scale-option" onclick="selectScale('life_change_scale', '1', this)">1</div>
                    <div class="scale-option" onclick="selectScale('life_change_scale', '2', this)">2</div>
                    <div class="scale-option" onclick="selectScale('life_change_scale', '3', this)">3</div>
                    <div class="scale-option" onclick="selectScale('life_change_scale', '4', this)">4</div>
                    <div class="scale-option" onclick="selectScale('life_change_scale', '5', this)">5</div>
                </div>
                <input type="hidden" name="life_change_scale" id="life_change_scale" required>
            </div>

            <!-- Question 4: Price -->
            <div class="question">
                <h2>Would a monthly commitment of $10 to Harder feel comfortable for you?</h2>

                <div class="choices">
                    <div class="choice" onclick="selectChoice('commitment', 'yes', this)">
                        <input type="radio" name="commitment" value="yes" id="commitment_yes">
                        <label for="commitment_yes">Yes</label>
                    </div>
                    
                    <div class="choice" onclick="selectChoice('commitment', 'no', this)">
                        <input type="radio" name="commitment" value="no" id="commitment_no">
                        <label for="commitment_no">No</label>
                    </div>
                </div>
            </div>


            <!-- Question 6: Email -->
            <!-- <div class="question">
                <h2>There is an upcoming app that will take care of that - sign up and we'll keep you
                    updated!</h2>
                <input type="email" name="email" class="email-input" placeholder="name@example.com" id="email-input" disabled required>

                <button type="submit" class="submit-btn">Submit your answers</button>
            </div> -->

            <div class="question">
                <h1 style="margin-bottom:initial;">Thank you for your feedback!</h1>
                <h3 style="text-align: center; font-weight: normal;">It is impactful to the future of this app and the world! &#127757;</h3>

                <div id="prolific-message" style="display: none; border: 1px solid var(--accent-blue); padding: 10px 20px; border-radius: 6px; margin-bottom: 20px; flex-direction: column;">
                    <h3>We noticed you come from Prolific. Please click the button below to claim your reward!</h3>
                    <a id="prolific-redirect-button" href="https://app.prolific.com/submissions/complete?cc=CDL3ASTB" style="background: var(--accent-blue); color: black; padding: 10px; border-radius: 6px; text-decoration: none; margin: 10px auto;">Claim Reward &#128176;</a>
                </div>
            </div>
<!-- 
            <div class="question">
                <h2>Based on your past responses we would like you to know that this exact form was built with the
                    assistance of AI</h2>
            </div> -->
        </form>
    </div>

    <script>
        // Configuration - UPDATE THIS WITH YOUR GOOGLE APPS SCRIPT WEB APP URL
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbz6THSkt_CQvZtpZ5hU_HjhM9ls8T3OXYWi20h2qgQvAcXmXeSRpVKo98tx3kh0XZZ4/exec';

        // Form data storage
        let formData = {};
        let questionOrder = [];
        let currentQuestionIndex = 0;
        let isChangingSlides = false;

        // Capture Prolific parameters from URL
        const urlParams = new URLSearchParams(window.location.search);
        const prolificMeta = {
            prolific_pid: urlParams.get('PROLIFIC_PID') || '',
            prolific_study_id: urlParams.get('STUDY_ID') || '',
            prolific_session_id: urlParams.get('SESSION_ID') || ''
        };

        if(prolificMeta.prolific_pid) {
            document.getElementById('prolific-message').style.display = 'flex';
        }

        function selectChoice(questionName, value, element) {
            if (isChangingSlides) return;
            isChangingSlides = true;

            const currentQuestion = document.querySelector('.question.current');
            currentQuestion.classList.add('disabled');

            // Remove selected class from siblings
            const siblings = element.parentNode.querySelectorAll('.choice');
            siblings.forEach(sibling => sibling.classList.remove('selected'));

            // Add selected class to clicked element
            element.classList.add('selected');

            // Update the radio button
            const radio = element.querySelector('input[type="radio"]');
            radio.checked = true;

            // Store the value
            formData[questionName] = radio.value;


            // Auto-advance to next question
            setTimeout(() => {
                isChangingSlides = false;
                nextQuestion();
            }, 300);
        }

        function getDisplayQuestionNumber(questionIndex) {
            // Map actual question indices to display numbers based on branching logic
            // Questions 1 and 2 are both branches after question 0, so both show as "2"
            // Question 5 (email) is not part of the questionnaire, so it stays at step 4
            switch (questionIndex) {
                case 0: return 1;  // First question
                case 1: return 2;  // Branch A after first question
                case 2: return 2;  // Branch B after first question (same display number)
                case 3: return 3;  // Third logical question
                case 4: return 4;  // Fourth logical question
                case 5: return 5;  // Fifth logical question
                default: return 1;
            }
        }

        function getQuestionIndexFromDisplayStep(displayStep) {
            // Map display step numbers back to actual question indices
            // Handle branching logic - for step 2, choose based on previous answer
            switch (displayStep) {
                case 1: return 0;  // First question
                case 2: 
                    // For step 2, determine which branch based on previous answer
                    if (formData.struggle_goals === "rarely") {
                        return 2;  // Branch B
                    } else {
                        return 1;  // Branch A
                    }
                case 3: return 3;  // Third logical question
                case 4: return 4;  // Fourth logical question
                default: return 0;
            }
        }

        function navigateToStep(displayStep) {
            const targetQuestionIndex = getQuestionIndexFromDisplayStep(displayStep);
            const currentDisplayStep = getDisplayQuestionNumber(currentQuestionIndex);
            
            // Only allow navigation to completed steps or current step
            if (displayStep <= currentDisplayStep) {
                loadQuestion(targetQuestionIndex);
            }
        }

        function updateProgressIndicator(questionIndex) {
            const displayNumber = getDisplayQuestionNumber(questionIndex);
            const dots = document.querySelectorAll('.progress-dot');
            const lines = document.querySelectorAll('.progress-line');
            
            // Reset all dots and lines
            dots.forEach(dot => {
                dot.classList.remove('active', 'completed', 'clickable');
            });
            lines.forEach(line => {
                line.classList.remove('completed');
            });
            
            // Special case: if we're on the email question (index 5), show all questionnaire steps as completed
            if (questionIndex === 5) {
                // Mark all dots as completed and clickable
                dots.forEach(dot => {
                    dot.classList.add('completed', 'clickable');
                });
                // Mark all lines as completed
                lines.forEach(line => {
                    line.classList.add('completed');
                });
                return;
            }
            
            // Mark completed steps and lines
            for (let i = 1; i < displayNumber; i++) {
                const dot = document.querySelector(`[data-step="${i}"]`);
                if (dot) {
                    dot.classList.add('completed', 'clickable');
                }
                
                // Mark the line before this step as completed
                if (i > 1) {
                    const lineIndex = i - 2; // Lines are 0-indexed, steps are 1-indexed
                    if (lines[lineIndex]) lines[lineIndex].classList.add('completed');
                }
            }
            
            // Mark current step as active and clickable
            const currentDot = document.querySelector(`[data-step="${displayNumber}"]`);
            if (currentDot) {
                currentDot.classList.add('active', 'clickable');
            }
        }

        function loadQuestion(questionIndex) {
            console.log('Loading question', questionIndex);
            const currentQuestion = document.querySelector('.question.current');
            if (currentQuestion) {
                currentQuestion.classList.remove('current');
                currentQuestion.classList.add('previous');
            }

            const questions = document.querySelectorAll('.question');
            questions[questionIndex].classList.add('current');
            questions[questionIndex].classList.remove('previous', 'disabled');
            currentQuestionIndex = questionIndex;
            
            // Update progress indicator
            updateProgressIndicator(questionIndex);
        }

        function selectScale(questionName, value, element) {
            if (isChangingSlides) return;
            isChangingSlides = true;

            // Remove selected class from siblings
            const siblings = element.parentNode.querySelectorAll('.scale-option');
            siblings.forEach(sibling => sibling.classList.remove('selected'));

            // Add selected class to clicked element
            element.classList.add('selected');

            // Update the hidden input
            document.getElementById(questionName).value = value;

            // Store the value
            formData[questionName] = value;

            // Auto-advance to next question
            setTimeout(() => {
                isChangingSlides = false;
                nextQuestion();
            }, 300);
        }

        async function nextQuestion() {
            console.log('Next question', currentQuestionIndex);
            switch (currentQuestionIndex) {
                case 0:
                    {
                        if(formData.struggle_goals === "rarely") {
                            loadQuestion(2);
                        } else {
                            loadQuestion(1);
                        }
                    }

                    break;
                case 1:
                case 2:
                    loadQuestion(3);
                    break;
                case 3:
                    loadQuestion(4);
                    break;
                case 4:
                    await submitForm();
                    loadQuestion(5);
                    break;
            }
        }

        function getCurrentQuestionId() {
            const currentQuestion = document.querySelector('.question.current');
            return currentQuestion ? currentQuestion.id || `question-${currentQuestionIndex}` : null;
        }

        // Form submission handler
        async function submitForm() {
            console.log('Submitting form');
            if(currentQuestionIndex !== 4) {
                return;
            }

            // Collect all form data
            const formDataObj = new FormData(document.getElementById('aiCoachForm'));
            const data = {};

            // Convert FormData to regular object
            for (let [key, value] of formDataObj.entries()) {
                data[key] = value;
            }

            // Map to the expected format for Google Sheets
            const submissionData = {
                struggle_with_goals: data.struggle_goals || '',
                life_change_scale: data.life_change_scale || '',
                commitment: data.commitment || '',
                would_achieve_more: data.would_achieve_more || '',
                achievement_scale: data.achievement_scale || '',
                feeling_about_ai: data.feeling_ai || '',
                email: data.email || '',
                prolific_pid: prolificMeta.prolific_pid,
                prolific_study_id: prolificMeta.prolific_study_id,
                prolific_session_id: prolificMeta.prolific_session_id,
                userAgent: navigator.userAgent,
                ipAddress: 'Not available (client-side)',
                timestamp: new Date().toISOString()
            };

            // Disable submit button
            const currentQuestion = document.querySelector('.question.current');
            currentQuestion.classList.add('disabled');
            // const submitBtn = e.target.querySelector('.submit-btn');
            // submitBtn.disabled = true;
            // submitBtn.textContent = 'Submitting...';

            try {
                // Send data to Google Apps Script
                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    body: JSON.stringify(submissionData)
                });

                const result = await response.json();

                if (result.success) {
                    loadQuestion(5);
                } else {
                    throw new Error(result.message || 'Unknown error occurred');
                }

            } catch (error) {
                console.error('Error submitting form:', error);
                alert('There was an error submitting your response. Please try again.');

                // Re-enable submit button
                submitBtn.disabled = false;
                submitBtn.textContent = 'Submit Questionnaire';
            }
        }

        // Initialize progressive question navigation
        document.addEventListener('DOMContentLoaded', function () {
            const questions = Array.from(document.querySelectorAll('.question'));

            // Initialize question order (excluding conditional question 4)
            questionOrder = questions.map((q, i) => q.id || `question-${i}`).filter(id => id !== 'question4');

            // Add click event listeners to progress dots
            const progressDots = document.querySelectorAll('.progress-dot');
            progressDots.forEach(dot => {
                dot.addEventListener('click', function() {
                    if (isChangingSlides) return; // Prevent clicks during transitions
                    
                    const step = parseInt(this.getAttribute('data-step'));
                    const currentDisplayStep = getDisplayQuestionNumber(currentQuestionIndex);
                    
                    // Only allow navigation to completed steps or current step
                    if (step <= currentDisplayStep) {
                        navigateToStep(step);
                    }
                });
            });

            // Show first question and initialize progress indicator
            if (questions.length > 0) {
                questions[0].classList.add('current');
                updateProgressIndicator(0); // Initialize progress indicator
            }
        });
    </script>
</body>

</html>